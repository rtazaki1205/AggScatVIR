<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python Tools &mdash; AggScatVIR v0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running RADMC-3D with AggScatVIR" href="radmc3d.html" />
    <link rel="prev" title="Get started" href="struct.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> AggScatVIR
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">What is AggScatVIR?</a></li>
<li class="toctree-l1"><a class="reference internal" href="struct.html">Get started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Reading-dust-files-in-the-database">Reading dust files in the database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Basic-formula">Basic formula</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Check-physical-and-optical-properties">Check physical and optical properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Scattering-matrix-in-Bohren-&amp;-Huffman’s-definition">Scattering matrix in Bohren &amp; Huffman’s definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Changing-the-size-distribution-and-the-chop-angle">Changing the size distribution and the chop angle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Basic formula</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Output-RADMC-3D-input-file-for-a-new-size-distribution/chop-model">Output RADMC-3D input file for a new size distribution/chop model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reloading-a-dust-file-generated-by-this-tool">Reloading a dust file generated by this tool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Writing-files">Writing files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Example-analysis">Example analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Comparing-phase-functions-of-different-fractal-dimensions">Comparing phase functions of different fractal dimensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Polarization-phase-functions">Polarization phase functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="radmc3d.html">Running RADMC-3D with AggScatVIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="app_def.html">Appendix A: Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="app_gallery.html">Appendix B: Gallery of optical properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Appendix C: Python modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AggScatVIR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Python Tools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/examples.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Python-Tools">
<h1>Python Tools<a class="headerlink" href="#Python-Tools" title="Permalink to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">AggScatVIR</span></code> package provides some python tools that may be useful for users to quickly delve into the optical properties stored in this database. The main functionalities of this tool are: (1) check and plot the optical properties of dust particles stored in this database, (2) convert the unit of the scattering matrix elements from RADMC-3D’s definition to Bohren &amp; Huffman’s definition, (3) change the power-law index of size distribution and the chop angle from the default values, (4)
output datafiles in various formats.</p>
<p>In this section, we demonstrate how to use it and what we can do with this tools.</p>
<p>Note that this python package has been tested with Python 3.8.5.</p>
<div class="section" id="Reading-dust-files-in-the-database">
<h2>Reading dust files in the database<a class="headerlink" href="#Reading-dust-files-in-the-database" title="Permalink to this heading"></a></h2>
<p>The first thing we need to do is to import the necessary module:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aggscatpy</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="Basic-formula">
<h3>Basic formula<a class="headerlink" href="#Basic-formula" title="Permalink to this heading"></a></h3>
<p>Let’s read one of dustkapscatmat_XXX.inp stored in the <code class="docutils literal notranslate"><span class="pre">AggScatVIR</span></code> database. To do this, we can use the <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> class.</p>
<p>The basic command for accessing a dust file for aggregates is</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s1">&#39;4096&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">partype</span></code> is the particle type, <code class="docutils literal notranslate"><span class="pre">size</span></code> is the size of the largest aggregate in the size distribution (in units of the number of monomers), <code class="docutils literal notranslate"><span class="pre">amon</span></code> is the monomer radius, and <code class="docutils literal notranslate"><span class="pre">comp</span></code> is the monomer composition. The arguments take values that are the same as what we used in their file names. After running this command, the instance <code class="docutils literal notranslate"><span class="pre">a</span></code> contains the physical and optical properties of the dust model of <code class="docutils literal notranslate"><span class="pre">CALP_Nmax4096_100nm_amc</span></code>.</p>
<p>To confirm that the above command has loaded the correct file, you can use the <code class="docutils literal notranslate"><span class="pre">path</span></code> attribute to display the relative path of the file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">path</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;../aggscatrt/distave/nochop/dustkapscatmat_CALP_Nmax4096_100nm_amc.inp&#39;
</pre></div></div>
</div>
<p>We can get a list of a possible combination between the <code class="docutils literal notranslate"><span class="pre">amon</span></code> and <code class="docutils literal notranslate"><span class="pre">size</span></code> arguments by using the <code class="docutils literal notranslate"><span class="pre">get_sizelist</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_sizelist</span><span class="p">(</span><span class="s1">&#39;CALP&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 Available amon and size for CALP
 amon=&#39;100nm&#39; | size=&#39;8&#39;,&#39;16&#39;,&#39;32&#39;,&#39;64&#39;,&#39;128&#39;,&#39;256&#39;,&#39;512&#39;,&#39;1024&#39;,&#39;2048&#39;,&#39;4096&#39;
 amon=&#39;200nm&#39; | size=&#39;8&#39;,&#39;16&#39;,&#39;32&#39;,&#39;64&#39;,&#39;128&#39;,&#39;256&#39;,&#39;512&#39;
 amon=&#39;400nm&#39; | size=&#39;8&#39;,&#39;16&#39;,&#39;32&#39;,&#39;64&#39;
</pre></div></div>
</div>
<p>Similarly, the command for a dust file for irregular grains is</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;grs&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s1">&#39;1_6000&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;org&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">path</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;../aggscatrt/distave/nochop/dustkapscatmat_grs_rvmax1_6000um_org.inp&#39;
</pre></div></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">partype</span></code> has to be <code class="docutils literal notranslate"><span class="pre">'grs'</span></code>. The <code class="docutils literal notranslate"><span class="pre">size</span></code> argument represents the volume-equivalent radius of maximum grains in the size distribution in units of microns (the decimal point needs to be replaced by an underscore). For example, <code class="docutils literal notranslate"><span class="pre">size='1_6000'</span></code> means that the volume-equivalent radius (of the maximum grain) is <span class="math notranslate nohighlight">\(1.6~\mu\)</span>m.</p>
<p>You can get a list of the available size argument for irregular grains:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_sizelist</span><span class="p">(</span><span class="s1">&#39;grs&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;0_2000&#39;,
 &#39;0_2520&#39;,
 &#39;0_3175&#39;,
 &#39;0_4000&#39;,
 &#39;0_5040&#39;,
 &#39;0_6350&#39;,
 &#39;0_8000&#39;,
 &#39;1_0079&#39;,
 &#39;1_2699&#39;,
 &#39;1_6000&#39;]
</pre></div></div>
</div>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> class will read a dust file <strong>with size distribution and without any forward-scattering chopping</strong>. If you would like to change these, you need to specify two additional arguments: <code class="docutils literal notranslate"><span class="pre">dist</span></code> and <code class="docutils literal notranslate"><span class="pre">chop</span></code> when calling the <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> class. For example, if you want to switch off the size distribution, you need to set <code class="docutils literal notranslate"><span class="pre">dist=False</span></code> (default: <code class="docutils literal notranslate"><span class="pre">dist=True</span></code>). If you would like to have the data with chopped forward scattering, you can set either <code class="docutils literal notranslate"><span class="pre">chop='chop5'</span></code> or
<code class="docutils literal notranslate"><span class="pre">chop='chop10'</span></code> (default: <code class="docutils literal notranslate"><span class="pre">chop='nochop'</span></code>). <code class="docutils literal notranslate"><span class="pre">chop5</span></code> and <code class="docutils literal notranslate"><span class="pre">chop10</span></code> refer to cases where the forward scattering peak is chopeed below scattering angles of 5 or 10 degrees, respectively. Thus if you need the optical properties without assuming particle-size distribution and with the forward-scattering chopping of 5 degrees, the command becomes</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a2</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s1">&#39;4096&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">dist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">chop</span><span class="o">=</span><span class="s1">&#39;chop5&#39;</span><span class="p">)</span>
<span class="n">a2</span><span class="o">.</span><span class="n">path</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;../aggscatrt/single/chop5/dustkapscatmat_CALP_4096_100nm_amc_chop5.inp&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="Check-physical-and-optical-properties">
<h3>Check physical and optical properties<a class="headerlink" href="#Check-physical-and-optical-properties" title="Permalink to this heading"></a></h3>
<p>Each instance created by <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> contains the physical and optical properties of the dust model as its attributes (see Appendix C for the attributes). The python tool inclues some functions that allow us to quick overview of the values stored in its attributes.</p>
<p>We can display the physical properties of the dust particle stored in the instance <code class="docutils literal notranslate"><span class="pre">a</span></code> by using the <code class="docutils literal notranslate"><span class="pre">dustspec</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dustspec</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
=============== Dust Parameters ================
 Model name = CALP_Nmax4096_100nm_amc
 Monomer radius           (um) = 0.10000
 Material density       (g/cc) = 1.7779
 -----Minimum aggregate in the distribution-----
 Number of monomers            = 8
 Volume-eq radius         (um) = 2.00000e-01
 Characteristic radius    (um) = 2.22916e-01
 Porosity                  (%) = 27.78
 -----Maximum aggregate in the distribution-----
 Number of monomers            = 4096
 Volume-eq radius         (um) = 1.60000e+00
 Characteristic radius    (um) = 2.34047e+00
 Porosity                  (%) = 68.05
 -----------------------------------------------
 Power-law index of size dist. = 3.50000e+00
 chop angle (deg)              = 0.00000e+00
================================================
</pre></div></div>
</div>
<p>Also, we can make some plots for the optical properties of the dust particle by using the <code class="docutils literal notranslate"><span class="pre">showmodel</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">showmodel</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/examples_19_0.png" src="_images/examples_19_0.png" />
</div>
</div>
<p>The above plots summarize the absorption and scattering opacities (<span class="math notranslate nohighlight">\(\kappa_\mathrm{abs}\)</span>, <span class="math notranslate nohighlight">\(\kappa_\mathrm{sca}\)</span>) (<em>left top</em>), the single scattering albedo (<span class="math notranslate nohighlight">\(\omega\)</span>), the asymmetry parameter (<span class="math notranslate nohighlight">\(g\)</span>), and the maximum degree of linear polarization (<span class="math notranslate nohighlight">\(P_\mathrm{max}\)</span>) (<em>left bottom</em>), the scattering phase function (<em>right top</em>) and the degree of linear polarization (<em>right bottom</em>) at various wavelengths.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">showmodel</span></code> function has some options that might be useful for you: (1) If you set <code class="docutils literal notranslate"><span class="pre">opacity=False</span></code>, the left top panel will be replaced by cross sections (<span class="math notranslate nohighlight">\(\mu\mathrm{m}^2\)</span>) instead of the opacity (<span class="math notranslate nohighlight">\(\mathrm{cm}^2/g\)</span>) (2) If you set <code class="docutils literal notranslate"><span class="pre">savefig=True</span></code>, the plot will be saved. The file name will be generated automaticlly, but you can set your own file name by further adding <code class="docutils literal notranslate"><span class="pre">fn=your_favorate_filename</span></code>.</p>
<p>You can get the values directly by calling the attributes:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%13s</span><span class="s1"> &#39;</span><span class="o">*</span><span class="mi">4</span><span class="o">%</span><span class="p">(</span><span class="s2">&quot;lambda&quot;</span><span class="p">,</span><span class="s2">&quot;kabs&quot;</span><span class="p">,</span><span class="s2">&quot;ksca&quot;</span><span class="p">,</span><span class="s2">&quot;asym&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">nlmd</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%13.6e</span><span class="s1"> &#39;</span><span class="o">*</span><span class="mi">4</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">lmd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">kabs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">ksca</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">asym</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
       lambda          kabs          ksca          asym
 5.540000e-01  1.478310e+04  1.324085e+04  8.782218e-01
 7.350000e-01  1.471897e+04  1.339719e+04  8.523817e-01
 1.040000e+00  1.345137e+04  1.305858e+04  7.994422e-01
 1.250000e+00  1.230322e+04  1.249605e+04  7.724140e-01
 1.630000e+00  1.047132e+04  1.113624e+04  7.433839e-01
 2.180000e+00  8.285653e+03  9.240539e+03  7.224008e-01
 3.780000e+00  4.970084e+03  5.227980e+03  6.553526e-01
</pre></div></div>
</div>
<p>The scattering angle grid is</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">scatang</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[  0.   1.   2.   3.   4.   5.   6.   7.   8.   9.  10.  11.  12.  13.
  14.  15.  16.  17.  18.  19.  20.  21.  22.  23.  24.  25.  26.  27.
  28.  29.  30.  31.  32.  33.  34.  35.  36.  37.  38.  39.  40.  41.
  42.  43.  44.  45.  46.  47.  48.  49.  50.  51.  52.  53.  54.  55.
  56.  57.  58.  59.  60.  61.  62.  63.  64.  65.  66.  67.  68.  69.
  70.  71.  72.  73.  74.  75.  76.  77.  78.  79.  80.  81.  82.  83.
  84.  85.  86.  87.  88.  89.  90.  91.  92.  93.  94.  95.  96.  97.
  98.  99. 100. 101. 102. 103. 104. 105. 106. 107. 108. 109. 110. 111.
 112. 113. 114. 115. 116. 117. 118. 119. 120. 121. 122. 123. 124. 125.
 126. 127. 128. 129. 130. 131. 132. 133. 134. 135. 136. 137. 138. 139.
 140. 141. 142. 143. 144. 145. 146. 147. 148. 149. 150. 151. 152. 153.
 154. 155. 156. 157. 158. 159. 160. 161. 162. 163. 164. 165. 166. 167.
 168. 169. 170. 171. 172. 173. 174. 175. 176. 177. 178. 179. 180.]
</pre></div></div>
</div>
<p>Each instance contains the scattering phase function (<code class="docutils literal notranslate"><span class="pre">phase</span></code>) and 6 scattering matrix elements (<code class="docutils literal notranslate"><span class="pre">smat11</span></code>,<code class="docutils literal notranslate"><span class="pre">smat12</span></code>,<code class="docutils literal notranslate"><span class="pre">smat22</span></code>,<code class="docutils literal notranslate"><span class="pre">smat33</span></code>,<code class="docutils literal notranslate"><span class="pre">smat34</span></code>,<code class="docutils literal notranslate"><span class="pre">smat44</span></code>) as its attributes. Note that the scattering matrix elements follow the RADMC-3D definition <span class="math notranslate nohighlight">\(Z_{ij}\)</span> (though it is possible to convert to the definition used by Bohren &amp; Huffman; see the next section for more information). Each of them is a function of both wavelength and scattering angle, resulting in a
two-dimensional array. For example, <span class="math notranslate nohighlight">\(Z_{11}(\lambda,\theta)\)</span> has the shape of:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">smat11</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(7, 181)
</pre></div></div>
</div>
<p>To fix the wavelength value, the first dimension should be fixed to the same index (note that the index starts from 0 as usual in python):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iwav</span><span class="o">=</span><span class="mi">0</span><span class="c1"># index for the wavelength grid</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wavelength (um) =&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">lmd</span><span class="p">[</span><span class="n">iwav</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">smat11</span><span class="p">[</span><span class="n">iwav</span><span class="p">,:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
wavelength (um) = 0.554
[1.78523701e+05 1.72076762e+05 1.54313366e+05 1.29350307e+05
 1.02329476e+05 7.77059918e+04 5.80906878e+04 4.40254779e+04
 3.45653906e+04 2.81956832e+04 2.35910583e+04 1.99552039e+04
 1.69623229e+04 1.45235619e+04 1.25808977e+04 1.10308479e+04
 9.74923875e+03 8.64216597e+03 7.66671589e+03 6.81441283e+03
 6.08339622e+03 5.46071838e+03 4.92454864e+03 4.45354507e+03
 4.03431975e+03 3.66028830e+03 3.32782113e+03 3.03245312e+03
 2.76826197e+03 2.52943988e+03 2.31199302e+03 2.11382100e+03
 1.93380792e+03 1.77096613e+03 1.62365691e+03 1.49021881e+03
 1.36866106e+03 1.25752151e+03 1.15558195e+03 1.06202720e+03
 9.76284542e+02 8.97925708e+02 8.26541315e+02 7.61695171e+02
 7.02873163e+02 6.49525719e+02 6.01067135e+02 5.56948310e+02
 5.16610929e+02 4.79575309e+02 4.45416373e+02 4.13847323e+02
 3.84689891e+02 3.57845984e+02 3.33254058e+02 3.10838706e+02
 2.90434396e+02 2.71863034e+02 2.54907267e+02 2.39364559e+02
 2.25080190e+02 2.11923313e+02 1.99800694e+02 1.88622796e+02
 1.78317009e+02 1.68818415e+02 1.60063005e+02 1.52006393e+02
 1.44602475e+02 1.37809215e+02 1.31578024e+02 1.25853434e+02
 1.20587034e+02 1.15729740e+02 1.11233669e+02 1.07058720e+02
 1.03176451e+02 9.95610613e+01 9.61988077e+01 9.30735846e+01
 9.01777024e+01 8.75010469e+01 8.50302105e+01 8.27590685e+01
 8.06742040e+01 7.87662024e+01 7.70201543e+01 7.54239170e+01
 7.39646475e+01 7.26281681e+01 7.14024737e+01 7.02765860e+01
 6.92443554e+01 6.82971010e+01 6.74282481e+01 6.66313619e+01
 6.59021268e+01 6.52355189e+01 6.46298134e+01 6.40794435e+01
 6.35835636e+01 6.31385302e+01 6.27427877e+01 6.23934658e+01
 6.20870720e+01 6.18220945e+01 6.15939791e+01 6.14023455e+01
 6.12440215e+01 6.11183206e+01 6.10230506e+01 6.09565973e+01
 6.09167990e+01 6.09043568e+01 6.09157808e+01 6.09507244e+01
 6.10087964e+01 6.10878845e+01 6.11884538e+01 6.13086688e+01
 6.14474816e+01 6.16053479e+01 6.17794697e+01 6.19726455e+01
 6.21806893e+01 6.24046256e+01 6.26430835e+01 6.28954983e+01
 6.31631301e+01 6.34425101e+01 6.37336046e+01 6.40379870e+01
 6.43531269e+01 6.46783742e+01 6.50129942e+01 6.53583050e+01
 6.57102859e+01 6.60714449e+01 6.64395286e+01 6.68148710e+01
 6.71966115e+01 6.75839667e+01 6.79774189e+01 6.83752527e+01
 6.87785084e+01 6.91855566e+01 6.95966571e+01 7.00101217e+01
 7.04262912e+01 7.08453499e+01 7.12653040e+01 7.16872892e+01
 7.21094206e+01 7.25318912e+01 7.29531296e+01 7.33732958e+01
 7.37924770e+01 7.42078859e+01 7.46220828e+01 7.50311903e+01
 7.54364010e+01 7.58354784e+01 7.62278272e+01 7.66127093e+01
 7.69869196e+01 7.73530694e+01 7.77063968e+01 7.80482375e+01
 7.83746383e+01 7.86850360e+01 7.89770127e+01 7.92512559e+01
 7.95023617e+01 7.97313405e+01 7.99342576e+01 8.01104834e+01
 8.02576310e+01 8.03740646e+01 8.04586167e+01 8.05095686e+01
 8.05255704e+01]
</pre></div></div>
</div>
<p>Thus <span class="math notranslate nohighlight">\(Z_{11}(\lambda,\theta)\)</span> for this dust model looks like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Z_</span><span class="si">{11}</span><span class="s1">~(\mathrm</span><span class="si">{cm}</span><span class="s1">^2/\mathrm</span><span class="si">{g}</span><span class="s1">/\mathrm</span><span class="si">{str}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;scattering angle (degrees)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iwav</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">nlmd</span><span class="p">):</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\lambda=$ </span><span class="si">%5.3f</span><span class="s1"> ($\mu\mathrm</span><span class="si">{m}</span><span class="s1">$)&#39;</span><span class="o">%</span><span class="k">a</span>.lmd[iwav]
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">scatang</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">smat11</span><span class="p">[</span><span class="n">iwav</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fef2e933880&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/examples_30_1.png" src="_images/examples_30_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Scattering-matrix-in-Bohren-&amp;-Huffman’s-definition">
<h2>Scattering matrix in Bohren &amp; Huffman’s definition<a class="headerlink" href="#Scattering-matrix-in-Bohren-&-Huffman’s-definition" title="Permalink to this heading"></a></h2>
<p>It is sometimes useful to have the scattering matrix elements in the Bohren &amp; Huffman definition. You can switch the definition into Bohren &amp; Huffman’s one by setting <code class="docutils literal notranslate"><span class="pre">smatBH=True</span></code> when calling the <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> class:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abh</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="s1">&#39;4096&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">smatBH</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, all the scattering matrix elements (<code class="docutils literal notranslate"><span class="pre">smat11</span></code>,<code class="docutils literal notranslate"><span class="pre">smat12</span></code>,<code class="docutils literal notranslate"><span class="pre">smat22</span></code>,<code class="docutils literal notranslate"><span class="pre">smat33</span></code>,<code class="docutils literal notranslate"><span class="pre">smat34</span></code>,<code class="docutils literal notranslate"><span class="pre">smat44</span></code>) stored in the instance <code class="docutils literal notranslate"><span class="pre">abh</span></code> are given in Bohren &amp; Huffman’s definition. Thus <span class="math notranslate nohighlight">\(S_{11}(\lambda,\theta)\)</span> looks like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$S_</span><span class="si">{11}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;scattering angle (degrees)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iwav</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">abh</span><span class="o">.</span><span class="n">nlmd</span><span class="p">):</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\lambda=$ </span><span class="si">%5.3f</span><span class="s1"> ($\mu\mathrm</span><span class="si">{m}</span><span class="s1">$)&#39;</span><span class="o">%</span><span class="k">abh</span>.lmd[iwav]
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">abh</span><span class="o">.</span><span class="n">scatang</span><span class="p">,</span><span class="n">abh</span><span class="o">.</span><span class="n">smat11</span><span class="p">[</span><span class="n">iwav</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fef2ef93f40&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/examples_35_1.png" src="_images/examples_35_1.png" />
</div>
</div>
</div>
<div class="section" id="Changing-the-size-distribution-and-the-chop-angle">
<h2>Changing the size distribution and the chop angle<a class="headerlink" href="#Changing-the-size-distribution-and-the-chop-angle" title="Permalink to this heading"></a></h2>
<p>We takes into account the particle-size distribution. The size distribution is assumed to have a simple power-law form:</p>
<div class="math notranslate nohighlight">
\[n(a_\mathrm{V})da_\mathrm{V}\propto a_\mathrm{V}^{-q}da_\mathrm{V}~(a_\mathrm{min}\le a_\mathrm{V} \le a_\mathrm{max}),\]</div>
<p>where <span class="math notranslate nohighlight">\(a_\mathrm{V}\)</span> is the volume-equivalent radius and <span class="math notranslate nohighlight">\(n(a_\mathrm{V})da_\mathrm{V}\)</span> is the number density of particles within a radius range of <span class="math notranslate nohighlight">\([a_\mathrm{V},a_\mathrm{V}+da_\mathrm{V}]\)</span>. For aggregates,</p>
<div class="math notranslate nohighlight">
\[\begin{split}a_\mathrm{min}=a_\mathrm{mon}N_\mathrm{min}^{1/3},\\
a_\mathrm{max}=a_\mathrm{mon}N_\mathrm{max}^{1/3},\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(N_\mathrm{min}\)</span> and <span class="math notranslate nohighlight">\(N_\mathrm{max}\)</span> are the number of monomers of the smallest and largest aggregate in the size distribution, respectively. By default, we assume <span class="math notranslate nohighlight">\(q=3.5\)</span>, <span class="math notranslate nohighlight">\(N_\mathrm{min}=8\)</span> for aggregates, and <span class="math notranslate nohighlight">\(a_\mathrm{V,min}=0.2~\mu\)</span>m for irregular grains.</p>
<p>However, you may be interested in the optical properties for different size distributions, such as <span class="math notranslate nohighlight">\(q\ne3.5\)</span> . To accommodate this, this python tool provides another class called <code class="docutils literal notranslate"><span class="pre">distaverage</span></code>, which allows for size-distribution averaging of the optical properties with user-specified values for <span class="math notranslate nohighlight">\(a_\mathrm{min}\)</span>, <span class="math notranslate nohighlight">\(a_\mathrm{max}\)</span>, and <span class="math notranslate nohighlight">\(q\)</span>. The <code class="docutils literal notranslate"><span class="pre">distaverage</span></code> class can also be utilized to modify the chop angle to arbitrary values.</p>
<div class="section" id="id1">
<h3>Basic formula<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>The basic command is</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;4096&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">powind</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The newly created instance <code class="docutils literal notranslate"><span class="pre">d</span></code> contains the distribution-averaged optical properties. The <code class="docutils literal notranslate"><span class="pre">sizemin</span></code> and <code class="docutils literal notranslate"><span class="pre">sizemax</span></code> represent the smallest and largest aggregates in the distribution in units of the number of monomers, respectively, and <code class="docutils literal notranslate"><span class="pre">powind</span></code> is the power-law index.</p>
<p>For irregular grains, the command looks like this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;grs&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;0_2000&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;1_6000&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;org&#39;</span><span class="p">,</span> <span class="n">powind</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As with the case of <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code>, an instance created by <code class="docutils literal notranslate"><span class="pre">distaverage</span></code> can be substituted into functions: <code class="docutils literal notranslate"><span class="pre">dustspec()</span></code>, <code class="docutils literal notranslate"><span class="pre">showmodel()</span></code>, and <code class="docutils literal notranslate"><span class="pre">write_data()</span></code> (the last function will be introduced later).</p>
<p>Since the parameters used above are exactly the same as the default values, the results should match those contained in the default dust files. As shown below, these two are in perfect agreement.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">nlmd</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wavelength = </span><span class="si">%6.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">lmd</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;     </span><span class="si">%-11s</span><span class="s1"> = </span><span class="si">%13.6e</span><span class="s1"> </span><span class="si">%13.6e</span><span class="s1"> </span><span class="si">%13.6e</span><span class="s1"> </span><span class="si">%13.6e</span><span class="s1">&#39;</span>\
          <span class="o">%</span><span class="p">(</span><span class="s2">&quot;tabulated&quot;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">kabs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">ksca</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">asym</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">a</span><span class="o">.</span><span class="n">pmax</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;     </span><span class="si">%-11s</span><span class="s1"> = </span><span class="si">%13.6e</span><span class="s1"> </span><span class="si">%13.6e</span><span class="s1"> </span><span class="si">%13.6e</span><span class="s1"> </span><span class="si">%13.6e</span><span class="s1">&#39;</span>\
          <span class="o">%</span><span class="p">(</span><span class="s2">&quot;recomputed&quot;</span><span class="p">,</span><span class="n">d</span><span class="o">.</span><span class="n">kabs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">d</span><span class="o">.</span><span class="n">ksca</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">d</span><span class="o">.</span><span class="n">asym</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">d</span><span class="o">.</span><span class="n">pmax</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
wavelength =  0.554
     tabulated   =  1.478310e+04  1.324085e+04  8.782218e-01  5.710268e-01
     recomputed  =  1.478310e+04  1.324085e+04  8.782218e-01  5.710268e-01
wavelength =  0.735
     tabulated   =  1.471897e+04  1.339719e+04  8.523817e-01  5.509632e-01
     recomputed  =  1.471897e+04  1.339719e+04  8.523817e-01  5.509632e-01
wavelength =  1.040
     tabulated   =  1.345137e+04  1.305858e+04  7.994422e-01  6.768769e-01
     recomputed  =  1.345137e+04  1.305858e+04  7.994422e-01  6.768769e-01
wavelength =  1.250
     tabulated   =  1.230322e+04  1.249605e+04  7.724140e-01  7.304774e-01
     recomputed  =  1.230322e+04  1.249605e+04  7.724140e-01  7.304774e-01
wavelength =  1.630
     tabulated   =  1.047132e+04  1.113624e+04  7.433839e-01  7.730357e-01
     recomputed  =  1.047132e+04  1.113624e+04  7.433839e-01  7.730357e-01
wavelength =  2.180
     tabulated   =  8.285653e+03  9.240539e+03  7.224008e-01  8.013906e-01
     recomputed  =  8.285653e+03  9.240539e+03  7.224008e-01  8.013906e-01
wavelength =  3.780
     tabulated   =  4.970084e+03  5.227980e+03  6.553526e-01  8.534474e-01
     recomputed  =  4.970084e+03  5.227980e+03  6.553526e-01  8.534474e-01
</pre></div></div>
</div>
</div>
<div class="section" id="Examples">
<h3>Examples<a class="headerlink" href="#Examples" title="Permalink to this heading"></a></h3>
<p>If you want the size distribution between <span class="math notranslate nohighlight">\(N_\mathrm{min}=128\)</span> to <span class="math notranslate nohighlight">\(N_\mathrm{max}=2048\)</span> with the default size distrituion power-law index (<span class="math notranslate nohighlight">\(q=3.5\)</span>):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;128&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>… and change the power-law index to <span class="math notranslate nohighlight">\(q=2.5\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;128&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span>\
              <span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">powind</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>… and change the chop angle to 7 degrees:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;128&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span>\
              <span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">powind</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span><span class="n">chopang</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you set <span class="math notranslate nohighlight">\(N_\mathrm{min}=N_\mathrm{max}\)</span>, the calculation results will be the same as the single-sized results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can also change the definition of the scattering matrix elements:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span> <span class="n">smatBH</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Output-RADMC-3D-input-file-for-a-new-size-distribution/chop-model">
<h3>Output RADMC-3D input file for a new size distribution/chop model<a class="headerlink" href="#Output-RADMC-3D-input-file-for-a-new-size-distribution/chop-model" title="Permalink to this heading"></a></h3>
<p>If you have generated optical properties with a new particle size distribution or/and chop angle, you may wish to save them in a RADMC-3D readable format. This can be easily accomplished using the <code class="docutils literal notranslate"><span class="pre">write_dustkapscatamat</span></code> method:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">distaverage</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CALP&#39;</span><span class="p">,</span><span class="n">sizemin</span><span class="o">=</span><span class="s1">&#39;128&#39;</span><span class="p">,</span><span class="n">sizemax</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">,</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">powind</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">write_dustkapscatmat</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
writing ... dustkapscatmat_CALP_Nmin128_Nmax2048_pow2.5_100nm_amc.inp
</pre></div></div>
</div>
<p>The newly generated file, <code class="docutils literal notranslate"><span class="pre">dustkapscatmat_CALP_Nmin128_Nmax2048_pow2.5_100nm_amc.inp</span></code>, is formatted in a way that RADMC-3D can read. <strong>When using the ``write_dustkapscatmat method``, the scattering matrix elements must be given in RADMC’s definition</strong>. The filename will be automatically generated based on the minimum and maximum particle sizes, power-law index, and chopping angle (if non-zero). You can also modify the filename by setting the <code class="docutils literal notranslate"><span class="pre">fn</span></code> option.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">write_dustkapscatmat</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="s1">&#39;your_favorate_filename&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
writing ... dustkapscatmat_your_favorate_filename.inp
</pre></div></div>
</div>
</div>
<div class="section" id="Reloading-a-dust-file-generated-by-this-tool">
<h3>Reloading a dust file generated by this tool<a class="headerlink" href="#Reloading-a-dust-file-generated-by-this-tool" title="Permalink to this heading"></a></h3>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> class to reload a file with the format dustkapscatmat_XXX.inp generated by this tool. To do so, simply specify the relative path to the file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d2</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;./dustkapscatmat_your_favorate_filename.inp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
...reading  ./dustkapscatmat_your_favorate_filename.inp
</pre></div></div>
</div>
<p>Currently, the <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> class can only read files generated by this tool.</p>
</div>
</div>
<div class="section" id="Writing-files">
<h2>Writing files<a class="headerlink" href="#Writing-files" title="Permalink to this heading"></a></h2>
<p>While the dustkapscatmat_XXX.inp format is useful for storing all the optical properties of each dust model, it may be a bit inconvenient to quickly look into (plot) the contained results, particularly for a scattering matrix element. Thus the python tools offer a function called <code class="docutils literal notranslate"><span class="pre">write_data</span></code>, which allow for outputting the optical properties in various formats, such as opacity versus wavelength, scattering phase function at a single wavelength, and more.</p>
<p>An instance created by either the <code class="docutils literal notranslate"><span class="pre">dustmodel</span></code> or <code class="docutils literal notranslate"><span class="pre">distaverage</span></code> class can be passed to the <code class="docutils literal notranslate"><span class="pre">write_data</span></code> function, which will create a new file in various formats.</p>
<p>Suppose you have already defined an instance <code class="docutils literal notranslate"><span class="pre">a</span></code>, then you can type:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_data</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
writing ... dustkapscatmat_CALP_Nmax4096_100nm_amc.out
</pre></div></div>
</div>
<p>The file extension has been changed from .inp to .out to avoid confusion with RADMC3D input files. The filename will be automaticlly generated, but you can specify your own filename by setting <code class="docutils literal notranslate"><span class="pre">fn=your_favorate_filename</span></code> option.</p>
<p>The generated file has a structure very similar to RADMC-3D’s one, but it contains more columns for the angle-integrated quantities, such as absorption and scattering cross-sections, the maximum polarization, the single scatteiring albedo. <strong>The definition of the scattering matrix elements written to the file will be the same as the definition of the scattering matrix elements defined in each instance</strong>. Therefore, if you make an instance with <code class="docutils literal notranslate"><span class="pre">smatBH=True</span></code>, then the outputted scattering
matrix follows the Bohren &amp; Huffman’s way.</p>
<p>If you are only interested in the angle-integrated quantities (opacity, asymmetry parameter, …), you can add <code class="docutils literal notranslate"><span class="pre">output='integrated'</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_data</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
writing ... integrated_CALP_Nmax4096_100nm_amc.out
</pre></div></div>
</div>
<p>The generated file now only contains the angle-integrated quantities and not for scattering matrix elements. Conversely, if you are only interested in scattering matrix elements, then you can change the option like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_data</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;smat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd0.554um.out
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd0.735um.out
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd1.04um.out
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd1.25um.out
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd1.63um.out
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd2.18um.out
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd3.78um.out
</pre></div></div>
</div>
<p>This command will generate some files; the number of files to be generated will be the same as the number of the wavelengh grid (at most 7). If you do not need all wavelengths, you can limit the wavelength you want by futher adding an option:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">write_data</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;smat&#39;</span><span class="p">,</span><span class="n">wlist</span><span class="o">=</span><span class="p">[</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">1.63</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd1.25um.out
writing ... scatmat_CALP_Nmax4096_100nm_amc_lmd1.63um.out
</pre></div></div>
</div>
</div>
<div class="section" id="Example-analysis">
<h2>Example analysis<a class="headerlink" href="#Example-analysis" title="Permalink to this heading"></a></h2>
<div class="section" id="Comparing-phase-functions-of-different-fractal-dimensions">
<h3>Comparing phase functions of different fractal dimensions<a class="headerlink" href="#Comparing-phase-functions-of-different-fractal-dimensions" title="Permalink to this heading"></a></h3>
<p>For example, let’s examine how the phase function of aggregates changes with fractal dimension at the <span class="math notranslate nohighlight">\(H\)</span> band wavelength (<span class="math notranslate nohighlight">\(\lambda=1.63~\mu\)</span>m). We consider a fractal dimension of <span class="math notranslate nohighlight">\(D_\mathrm{f}=1.1\)</span>, <span class="math notranslate nohighlight">\(1.3\)</span>, <span class="math notranslate nohighlight">\(1.5\)</span>, and <span class="math notranslate nohighlight">\(1.9\)</span>.</p>
<p>To do so, first create some lists:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;FA19&#39;</span><span class="p">,</span><span class="s1">&#39;FA15&#39;</span><span class="p">,</span> <span class="s1">&#39;FA13&#39;</span><span class="p">,</span><span class="s1">&#39;FA11&#39;</span><span class="p">]</span> <span class="c1"># a list of particle types</span>
<span class="n">nmono</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="s1">&#39;512&#39;</span><span class="p">,</span> <span class="s1">&#39;256&#39;</span><span class="p">,</span><span class="s1">&#39;128&#39;</span><span class="p">]</span>      <span class="c1"># a list of the number of monomers</span>
<span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;$D_f=1.9$&#39;</span><span class="p">,</span><span class="s1">&#39;$D_f=1.5$&#39;</span><span class="p">,</span><span class="s1">&#39;$D_f=1.3$&#39;</span><span class="p">,</span><span class="s1">&#39;$D_f=1.1$&#39;</span><span class="p">]</span> <span class="c1"># a list of labels for lenged</span>
</pre></div>
</div>
</div>
<p>where we have assumed that smaller number of monomers for a lower fractal dimension to approximately fix the aggregate radius. To check the characteristic radius of an aggregate, you can use the <code class="docutils literal notranslate"><span class="pre">get_radius_and_porosity</span></code> function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pt</span><span class="p">)):</span>
    <span class="n">ac</span><span class="p">,</span><span class="n">por</span><span class="o">=</span><span class="n">get_radius_and_porosity</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">nmono</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Particle Type: </span><span class="si">%4s</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">pt</span>[i],&#39; Number of monomers = %4s&#39;%nmono[i],&#39; agg radius = %5.2f um&#39;%ac)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Particle Type: FA19  Number of monomers = 2048  agg radius =  6.72 um
Particle Type: FA15  Number of monomers =  512  agg radius =  6.60 um
Particle Type: FA13  Number of monomers =  256  agg radius =  6.73 um
Particle Type: FA11  Number of monomers =  128  agg radius =  6.56 um
</pre></div></div>
</div>
<p>Now we’ve confirmed that the four aggregates have approximately the same characteristic radius: <span class="math notranslate nohighlight">\(a_\mathrm{c}=6.645\pm0.085~\mu\)</span>m. Then, let’s make a plot of the phase function for those models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase function&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">set_ang_vs_phase</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pt</span><span class="p">)):</span>
    <span class="n">a</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="n">nmono</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;amc&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading dust model ... &#39;</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; wavelength=</span><span class="si">%5.2f</span><span class="s1"> (um)&#39;</span><span class="o">%</span><span class="k">a</span>.lmd[4], &#39;maximum aggregate radius = %5.2f (um)&#39;%a.acmax)
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">scatang</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">phase</span><span class="p">[</span><span class="mi">4</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Reading dust model ...  FA19_Nmax2048_100nm_amc
---&gt; wavelength= 1.63 (um) maximum aggregate radius =  6.72 (um)
Reading dust model ...  FA15_Nmax512_100nm_amc
---&gt; wavelength= 1.63 (um) maximum aggregate radius =  6.60 (um)
Reading dust model ...  FA13_Nmax256_100nm_amc
---&gt; wavelength= 1.63 (um) maximum aggregate radius =  6.73 (um)
Reading dust model ...  FA11_Nmax128_100nm_amc
---&gt; wavelength= 1.63 (um) maximum aggregate radius =  6.56 (um)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fef13801550&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/examples_78_2.png" src="_images/examples_78_2.png" />
</div>
</div>
</div>
<div class="section" id="Polarization-phase-functions">
<h3>Polarization phase functions<a class="headerlink" href="#Polarization-phase-functions" title="Permalink to this heading"></a></h3>
<p>Let’s give you one more example. In this example, we are going to see how the polarization phase function depends on aggregate radius and structure. Similar to the above example, we first make some lists:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nmono</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;8&#39;</span><span class="p">,</span><span class="s1">&#39;16&#39;</span><span class="p">,</span><span class="s1">&#39;32&#39;</span><span class="p">,</span><span class="s1">&#39;64&#39;</span><span class="p">,</span><span class="s1">&#39;128&#39;</span><span class="p">,</span><span class="s1">&#39;256&#39;</span><span class="p">,</span><span class="s1">&#39;512&#39;</span><span class="p">,</span><span class="s1">&#39;1024&#39;</span><span class="p">,</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="s1">&#39;4096&#39;</span><span class="p">]</span> <span class="c1"># a list of the number of monomers</span>
<span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N=8&#39;</span><span class="p">,</span><span class="s1">&#39;16&#39;</span><span class="p">,</span><span class="s1">&#39;32&#39;</span><span class="p">,</span><span class="s1">&#39;64&#39;</span><span class="p">,</span><span class="s1">&#39;128&#39;</span><span class="p">,</span><span class="s1">&#39;256&#39;</span><span class="p">,</span><span class="s1">&#39;512&#39;</span><span class="p">,</span><span class="s1">&#39;1024&#39;</span><span class="p">,</span><span class="s1">&#39;2048&#39;</span><span class="p">,</span><span class="s1">&#39;4096&#39;</span><span class="p">]</span> <span class="c1"># a list of labels for lenged</span>
</pre></div>
</div>
</div>
<p>Then, read and plot the dust models iteratively in the loop:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plots</span><span class="o">.</span><span class="n">set_ang_vs_phase</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">set_ang_vs_phase</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarization phase function&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">2.0e-1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Compact aggregates: CAHP&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Polarized phase function&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">2.0e-1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fractal aggregates: FA19&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nmono</span><span class="p">)):</span>
    <span class="n">a1</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;CAHP&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">nmono</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;org&#39;</span><span class="p">)</span>
    <span class="n">a2</span><span class="o">=</span><span class="n">dustmodel</span><span class="p">(</span><span class="n">partype</span><span class="o">=</span><span class="s1">&#39;FA19&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">nmono</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">amon</span><span class="o">=</span><span class="s1">&#39;100nm&#39;</span><span class="p">,</span><span class="n">comp</span><span class="o">=</span><span class="s1">&#39;org&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">scatang</span><span class="p">,</span><span class="n">a1</span><span class="o">.</span><span class="n">smat12</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span><span class="o">/</span><span class="n">a1</span><span class="o">.</span><span class="n">smat12</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">scatang</span><span class="p">,</span><span class="n">a2</span><span class="o">.</span><span class="n">smat12</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span><span class="o">/</span><span class="n">a2</span><span class="o">.</span><span class="n">smat12</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fef31860280&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/examples_82_1.png" src="_images/examples_82_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="struct.html" class="btn btn-neutral float-left" title="Get started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="radmc3d.html" class="btn btn-neutral float-right" title="Running RADMC-3D with AggScatVIR" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Ryo Tazaki.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>